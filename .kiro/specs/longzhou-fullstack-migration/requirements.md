# 龙舟投票系统全栈迁移需求文档

## 项目背景

当前龙舟投票系统使用纯前端方案（localStorage），需要迁移到完整的前后端分离架构，实现真正的数据持久化、防刷票功能和统计分析。

## 用户角色

- **游客用户**: 浏览作品、查看排行榜（无需登录）
- **注册用户**: 登录后可以投票、查看个人投票记录
- **系统管理员**: 管理用户、活动配置、查看统计数据
- **开发者**: 维护系统、部署更新

## 功能需求

### 需求1: 数据库迁移

**用户故事**: 作为开发者，我需要将现有的前端数据迁移到数据库中，以便实现数据持久化和多用户访问。

#### 验收标准
1. WHEN 执行数据库迁移脚本 THEN 系统应该成功创建4张核心表（投票记录、活动配置、作品信息、浏览记录）
2. WHEN 导入初始数据 THEN 系统应该包含8个示例作品和1个默认活动配置
3. WHEN 验证数据完整性 THEN 所有表结构、索引、存储过程都应该正确创建

### 需求2: 用户认证系统

**用户故事**: 作为用户，我需要通过账号密码登录系统，以便进行投票操作。

#### 验收标准
1. WHEN 用户访问投票页面 THEN 系统应该检查登录状态，未登录用户跳转到登录页
2. WHEN 用户输入正确的账号密码 THEN 系统应该登录成功并跳转到投票页面
3. WHEN 用户输入错误的账号密码 THEN 系统应该显示错误提示
4. WHEN 用户登录后 THEN 系统应该记住登录状态，刷新页面不需要重新登录
5. WHEN 用户点击退出登录 THEN 系统应该清除登录状态并跳转到首页

### 需求3: 后端API开发

**用户故事**: 作为前端开发者，我需要后端提供RESTful API接口，以便前端可以进行数据交互。

#### 验收标准
1. WHEN 调用作品列表API THEN 系统应该返回分页的作品数据
2. WHEN 已登录用户调用投票API THEN 系统应该记录投票并更新作品票数
3. WHEN 未登录用户调用投票API THEN 系统应该返回未授权错误
4. WHEN 用户超过每日投票限制 THEN 系统应该返回错误提示
5. WHEN 用户重复投票同一作品 THEN 系统应该阻止并返回错误信息
6. WHEN 调用浏览记录API THEN 系统应该记录用户浏览行为

### 需求4: 前端API适配

**用户故事**: 作为用户，我希望在使用新系统时体验与原系统一致，但数据更加可靠。

#### 验收标准
1. WHEN 用户访问投票页面 THEN 应该从API加载作品数据而不是localStorage
2. WHEN 已登录用户点击投票 THEN 应该调用后端API并实时更新界面
3. WHEN 未登录用户点击投票 THEN 应该跳转到登录页面
4. WHEN 用户查看详情页 THEN 应该记录浏览行为并更新浏览数
5. WHEN 用户刷新页面 THEN 登录状态和投票状态应该从服务器恢复
6. WHEN API调用失败 THEN 应该显示友好的错误提示

### 需求5: 活动配置管理

**用户故事**: 作为管理员，我希望能够通过后台配置活动规则，而不需要修改代码。

#### 验收标准
1. WHEN 管理员修改每日投票限制 THEN 前端应该自动应用新的限制规则
2. WHEN 管理员更新规则页面图片 THEN 前端应该显示新的图片
3. WHEN 管理员设置活动时间 THEN 系统应该在活动时间外禁止投票
4. WHEN 管理员修改活动说明 THEN 前端应该显示更新后的内容

## 技术约束

1. **后端框架**: 必须使用现有的RuoYi-Vue框架
2. **数据库**: 使用MySQL 8.0
3. **前端框架**: 保持现有的Vue 3 + TypeScript + Pinia架构
4. **兼容性**: 新系统必须与现有的前端组件兼容
5. **渐进迁移**: 支持分阶段实施，每个阶段都可以独立测试

## 性能要求

1. **响应时间**: API接口响应时间不超过500ms
2. **并发处理**: 支持至少100个并发用户同时投票
3. **数据一致性**: 投票操作必须保证数据一致性，防止重复投票
4. **可用性**: 系统可用性不低于99%

## 安全要求

1. **防刷票**: 每个用户每天最多投票3次，每个作品只能投票1次
2. **数据验证**: 所有API输入参数必须进行严格验证
3. **SQL注入防护**: 使用参数化查询防止SQL注入
4. **访问控制**: 管理接口需要权限验证

## 可用性要求

1. **错误处理**: 提供友好的错误提示信息
2. **加载状态**: 显示数据加载状态，避免用户等待
3. **离线处理**: API不可用时提供降级方案
4. **用户引导**: 为新功能提供必要的用户引导

## 维护性要求

1. **代码规范**: 遵循现有的代码规范和项目结构
2. **文档完整**: 提供完整的API文档和部署文档
3. **测试覆盖**: 关键功能需要有测试用例
4. **监控日志**: 提供必要的日志记录和错误监控

## 成功标准

1. **功能完整性**: 所有现有功能在新系统中正常工作
2. **数据准确性**: 投票数据、浏览数据统计准确
3. **用户体验**: 用户操作流程与原系统保持一致
4. **系统稳定性**: 系统运行稳定，无重大bug
5. **性能达标**: 满足所有性能和安全要求